# Regras Espec√≠ficas do Vilanova

## üéØ Contexto do Projeto

Vilanova √© um projeto **aberto e nunca finalizado** de cataloga√ß√£o, digitaliza√ß√£o e organiza√ß√£o da hist√≥ria da cantoria nordestina usando IA. Nasceu em Campina Grande, PB, mas √© feito para todo o Nordeste.

## üîë Regras Cr√≠ticas

### 1. Respeito √†s Adapta√ß√µes Fon√©ticas

**NUNCA CORRIGIR** o que parecem ser "erros" nas transcri√ß√µes. Os poetas adaptam palavras intencionalmente para manter a m√©trica.

**Exemplos corretos:**
- "dez de" pode ser pronunciado "d√©rbi" para m√©trica
- "para" vira "pra"
- Elis√µes s√£o intencionais

**Como lidar:**
- Transcrever o que foi dito (foneticamente)
- Anotar a palavra "correta" em metadados
- IA deve entender ambas as formas
- Valida√ß√£o deve aceitar adapta√ß√µes

### 2. Motes Corretos dos Estilos

- **Galope √† Beira Mar**: "Nos dez **de** galope na/da beira do mar"
- **Martelo Alagoano**: "Nos dez **p√©s** de martelo alagoano"

N√£o confundir com varia√ß√µes fon√©ticas na performance.

### 3. Sempre Use getDb(env)

**‚úÖ CORRETO:**
```typescript
const db = await getDb(env);
const result = await db.select().from(table);
```

**‚ùå ERRADO:**
```typescript
const db = drizzle(env); // Pula migrations!
```

### 4. Convers√£o SQLite Boolean

**‚úÖ CORRETO:**
```typescript
// Inserir
await db.insert(table).values({
  isActive: 1,  // ou 0
});

// Ler
const record = await db.select().from(table);
const isActive = record.isActive === 1; // Converter para boolean
```

## üìê Estrutura de Dados

### Estilo de Repente

```typescript
interface PoetryStyle {
  id: string;
  name: string; // "Galope √† Beira Mar"
  slug: string;
  versesPerStanza: number;
  syllablesPerVerse: number;
  rhymePattern: string; // "AAAAABBCCM"
  hasMote: boolean;
  motePosition?: number[];
  structure: VerseStructure; // JSON completo
}
```

### Adapta√ß√£o Fon√©tica

```typescript
interface VerseAdaptation {
  originalWord: string;      // "dez de"
  pronouncedAs: string;       // "d√©rbi"
  reason: string;             // "m√©trica"
  syllableCount: number;      // 2 s√≠labas
  isIntentional: boolean;     // true
}
```

## üõ†Ô∏è Tools Privadas

### Padr√£o para createPrivateTool

```typescript
const createMyPrivateTool = (env: Env) =>
  createPrivateTool({
    id: "MY_TOOL",
    description: "Only accessible to admins",
    inputSchema: z.object({
      // ...
    }),
    outputSchema: z.object({
      // ...
    }),
    execute: async ({ context, runtimeContext }) => {
      // Pegar request se necess√°rio
      const req = runtimeContext.get("req") as Request | undefined;
      
      // Sempre use getDb
      const db = await getDb(env);
      
      // L√≥gica aqui
      
      return { /* result */ };
    },
  });
```

## üé® Schemas de IA

### An√°lise de Verso

```typescript
const verseAnalysisSchema = {
  type: 'object',
  properties: {
    syllables: {
      type: 'array',
      items: {
        type: 'object',
        properties: {
          text: { type: 'string' },
          isStressed: { type: 'boolean' },
        },
      },
    },
    syllableCount: { type: 'number' },
    rhymeSound: { type: 'string' },
    adaptations: {
      type: 'array',
      items: {
        type: 'object',
        properties: {
          word: { type: 'string' },
          adaptation: { type: 'string' },
          reason: { type: 'string' },
        },
      },
    },
  },
};
```

### Prompt para Respeitar Adapta√ß√µes

```typescript
const analysisPrompt = `
IMPORTANTE - Adapta√ß√µes Fon√©ticas:
Os poetas frequentemente adaptam a pron√∫ncia de palavras para manter a m√©trica:
- "dez de" pode ser pronunciado "d√©rbi" 
- "para" pode virar "pra"
- Elis√µes e contra√ß√µes s√£o comuns

RESPEITE a inten√ß√£o original do autor. Se uma palavra parece estar "errada", 
√© prov√°vel que seja uma adapta√ß√£o intencional para a m√©trica.

Analise o seguinte verso: ${verse}
`;
```

## üìÖ Eventos Recorrentes

### Exemplo: Clube do Repente

```typescript
{
  title: "Clube do Repente",
  city: "Campina Grande",
  state: "PB",
  venue: "Casa da Cultura",
  startTime: "19:00",
  isRecurring: true,
  recurrenceRule: {
    frequency: "monthly",
    ordinal: "first",      // primeira
    weekday: 4             // quinta-feira (0=domingo)
  },
  recurrenceText: "Toda primeira quinta-feira do m√™s"
}
```

## üîÑ Workflow de Upload ‚Üí Cataloga√ß√£o

```typescript
// 1. Upload de √°udio
UPLOAD_AUDIO ‚Üí { audioFileId }

// 2. Transcri√ß√£o com Whisper
TRANSCRIBE_AUDIO ‚Üí { transcriptionId, fullText, segments }

// 3. Criar repente
CREATE_REPENTE_FROM_TRANSCRIPTION ‚Üí { repenteId, cantadorIds }

// 4. Extrair poesias individuais
EXTRACT_POETRIES_FROM_TRANSCRIPTION ‚Üí { poetryIds, styles }
```

## üåç Representa√ß√£o Regional

Sempre considerar todos os estados do Nordeste:
- Pernambuco (Caruaru, Recife, Serra Talhada)
- Para√≠ba (Campina Grande, Jo√£o Pessoa, Patos)
- Cear√° (Fortaleza, Juazeiro do Norte, Sobral)
- Rio Grande do Norte (Natal, Mossor√≥, Caic√≥)
- Alagoas, Sergipe, Bahia, Maranh√£o

## üéØ Princ√≠pios de Desenvolvimento

1. **Respeito √† Tradi√ß√£o**: Adapta√ß√µes s√£o intencionais
2. **Qualidade dos Dados**: Verificar antes de adicionar
3. **Inclus√£o**: Representar todo o Nordeste
4. **Acessibilidade**: Para todos os n√≠veis
5. **Documenta√ß√£o**: Sempre documentar decis√µes

## üìö Recursos

- Deploy: vilanova.deco.page
- Webs√©rie: [Entre Cordas e Poesia](https://www.youtube.com/watch?v=ULbBggbGpB8&list=PLngiJpynwciFIwyrG_EiOW-sKm1tRXSGU)
- Plans: `/plans/` para toda documenta√ß√£o

---

**Vilanova** - De Campina Grande para todo o Nordeste üéµ



